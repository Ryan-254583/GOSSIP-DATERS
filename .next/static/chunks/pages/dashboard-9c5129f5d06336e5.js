(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[26],{1075:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard",function(){return s(7917)}])},7315:function(e,t,s){"use strict";s.d(t,{I8:function(){return l},ZK:function(){return requestPermission},db:function(){return d},xi:function(){return listenForMessages}});var i=s(3977),n=s(9828),a=s(5876),r=s(2806);let o=(0,i.ZF)({apiKey:"AIzaSyBCVpeekEg6hJGGF-xLYPQfS2G_8bklv1Q",authDomain:"cuk-gossip.firebaseapp.com",projectId:"cuk-gossip",storageBucket:"cuk-gossip.appspot.com",messagingSenderId:"194442802549",appId:"1:194442802549:web:f2d377abb1bae3634ccf3c",measurementId:"G-ZP8JDESMH2"}),d=(0,n.ad)(o),l=(0,a.v0)(o),u=(0,r.KL)(o),requestPermission=async()=>{if(u)try{let e=await Notification.requestPermission();if("granted"===e){let e=await (0,r.LP)(u,{vapidKey:"YOUR_VAPID_KEY_HERE"});console.log("Notification permission granted, token:",e)}else console.log("Notifications denied by user")}catch(e){console.error("Error requesting notification permission:",e)}},listenForMessages=()=>{u&&(0,r.ps)(u,e=>{console.log("Message received: ",e),new Notification(e.notification.title,{body:e.notification.body,icon:"/avatars/male.png"})})}},7917:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return Dashboard}});var i=s(5893),n=s(7294),a=s(7315),r=s(5876),o=s(9828),d=s(1163);function Dashboard(){let e=(0,d.useRouter)(),[t,s]=(0,n.useState)(null),[R,S]=(0,n.useState)(null),[w,U]=(0,n.useState)("discover"),[k,B]=(0,n.useState)([]),[I,L]=(0,n.useState)(!0),[T,E]=(0,n.useState)([]),[F,P]=(0,n.useState)(""),[N,_]=(0,n.useState)(!1),[M,J]=(0,n.useState)(null),[A,D]=(0,n.useState)([]),[K,O]=(0,n.useState)(""),G=(0,n.useRef)(null),X=(0,n.useRef)(null),[z,H]=(0,n.useState)([]),[q,Q]=(0,n.useState)(!0),avatarFor=e=>e?"female"===e.gender?"/avatars/female.png":e.photoURL||"/avatars/male.png":"/avatars/male.png";(0,n.useEffect)(()=>{let t=(0,r.Aj)(a.I8,async t=>{if(!t){e.push("/signin");return}s(t);let i=(0,o.JU)(a.db,"users",t.uid),n=await (0,o.QT)(i);if(n.exists())S(n.data());else{let e={uid:t.uid,username:t.displayName||(t.email?t.email.split("@")[0]:"User"),gender:null,photoURL:t.photoURL||null,email:t.email,createdAt:(0,o.Bt)()};await (0,o.pl)(i,e),S(e)}});return()=>t()},[]),(0,n.useEffect)(()=>{(0,a.ZK)(),(0,a.xi)();let e=(0,o.IO)((0,o.hJ)(a.db,"users"),(0,o.Xo)("createdAt","desc")),t=!0,s=(0,o.cf)(e,e=>{if(t){t=!1;return}let s=e.docChanges().filter(e=>"added"===e.type)[0];if(s){let e=s.doc.data();"granted"===Notification.permission&&new Notification("\uD83C\uDF89 New User Joined!",{body:"".concat(e.username," just joined CUK Gossip."),icon:e.photoURL||"/avatars/male.png"})}});return()=>s()},[]),(0,n.useEffect)(()=>{if(!R)return;L(!0);let e=(0,o.IO)((0,o.hJ)(a.db,"users"),(0,o.Xo)("createdAt","desc")),t=(0,o.cf)(e,e=>{let t=e.docs.map(e=>e.data()).filter(e=>e.uid!==R.uid);B(t),L(!1)});return()=>t()},[R]),(0,n.useEffect)(()=>{let e=(0,o.IO)((0,o.hJ)(a.db,"communityFeed"),(0,o.Xo)("timestamp","desc")),t=(0,o.cf)(e,e=>{E(e.docs.map(e=>({id:e.id,...e.data()})))});return()=>t()},[]),(0,n.useEffect)(()=>{if(!R)return;Q(!0);let e=(0,o.IO)((0,o.hJ)(a.db,"chats"),(0,o.ar)("users","array-contains",R.uid),(0,o.Xo)("lastUpdated","desc")),t=(0,o.cf)(e,e=>{let t=e.docs.map(e=>({id:e.id,...e.data()}));H(t),Q(!1)});return()=>t()},[R]);let chatIdFor=(e,t)=>[e,t].sort().join("_"),openPrivateChat=async e=>{if(!R)return;let t=chatIdFor(R.uid,e.uid),s=(0,o.JU)(a.db,"chats",t),i=await (0,o.QT)(s);i.exists()||await (0,o.pl)(s,{users:[R.uid,e.uid],userMeta:{[R.uid]:{username:R.username,photoURL:R.photoURL||null},[e.uid]:{username:e.username,photoURL:e.photoURL||null}},createdAt:(0,o.Bt)(),lastUpdated:(0,o.Bt)()}),subscribeToChatMessages(t),J(e),U("messages")},subscribeToChatMessages=e=>{if(X.current&&(X.current(),X.current=null),!e)return;let t=(0,o.hJ)(a.db,"chats",e,"messages"),s=(0,o.IO)(t,(0,o.Xo)("timestamp","asc")),i=(0,o.cf)(s,e=>{let t=e.docs.map(e=>({id:e.id,...e.data()}));D(t),setTimeout(()=>{G.current&&(G.current.scrollTop=G.current.scrollHeight)},80)});X.current=i},sendPrivateMessage=async e=>{if(null==e||e.preventDefault(),!K.trim()||!R||!M)return;let t=chatIdFor(R.uid,M.uid);await (0,o.ET)((0,o.hJ)(a.db,"chats",t,"messages"),{senderUid:R.uid,senderName:R.username,text:K.trim(),timestamp:(0,o.Bt)()}),await (0,o.pl)((0,o.JU)(a.db,"chats",t),{lastUpdated:(0,o.Bt)()},{merge:!0}),O("")},postToCommunity=async e=>{null==e||e.preventDefault(),F.trim()&&R&&(_(!0),await (0,o.ET)((0,o.hJ)(a.db,"communityFeed"),{uid:R.uid,username:R.username,text:F.trim(),timestamp:(0,o.Bt)()}),P(""),_(!1))},doLogout=async()=>{await (0,r.w7)(a.I8),localStorage.removeItem("user"),e.push("/signin")};return R?(0,i.jsxs)("div",{style:{minHeight:"100vh",background:"#070708",color:"#fff",fontFamily:"Inter, sans-serif"},children:[(0,i.jsxs)("header",{style:u,children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{style:{color:"#ff5252",fontSize:20},children:"CUK Gossip"}),(0,i.jsx)("div",{style:{fontSize:12,color:"#aaa"},children:"Meet • Chat • Connect"})]}),(0,i.jsxs)("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[(0,i.jsxs)("div",{style:{textAlign:"right"},children:[(0,i.jsx)("div",{style:{fontWeight:700},children:R.username}),(0,i.jsx)("div",{style:{fontSize:12,color:"#bbb"},children:R.gender||"Not specified"})]}),(0,i.jsx)("img",{src:R.photoURL||avatarFor(R),alt:"me",style:{width:44,height:44,borderRadius:999}}),(0,i.jsx)("button",{onClick:doLogout,style:c,children:"Logout"})]})]}),(0,i.jsxs)("nav",{style:m,children:[(0,i.jsx)("button",{onClick:()=>U("discover"),style:tabButton("discover"===w),children:"Discover"}),(0,i.jsx)("button",{onClick:()=>U("messages"),style:tabButton("messages"===w),children:"Messages"}),(0,i.jsx)("button",{onClick:()=>U("community"),style:tabButton("community"===w),children:"Community"}),(0,i.jsx)("button",{onClick:()=>U("profile"),style:tabButton("profile"===w),children:"Profile"})]}),(0,i.jsxs)("main",{style:{maxWidth:1e3,margin:"20px auto",padding:"0 14px"},children:["discover"===w&&(0,i.jsxs)("section",{children:[(0,i.jsx)("h2",{style:p,children:"Discover"}),I?(0,i.jsx)("div",{style:h,children:"Loading…"}):(0,i.jsxs)("div",{style:g,children:[0===k.length&&(0,i.jsx)("div",{style:j,children:"No users found."}),k.map(e=>(0,i.jsxs)("div",{style:f,children:[(0,i.jsx)("img",{src:e.photoURL||avatarFor(e),alt:e.username,style:b}),(0,i.jsx)("div",{style:{marginTop:6,fontWeight:700},children:e.username}),(0,i.jsx)("div",{style:{color:"#bbb",fontSize:13,marginBottom:8},children:e.gender||"-"}),(0,i.jsx)("button",{onClick:()=>openPrivateChat(e),style:x,children:"Message"})]},e.uid))]})]}),"messages"===w&&(0,i.jsxs)("section",{children:[(0,i.jsx)("h2",{style:p,children:"Messages"}),M?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{style:y,ref:G,children:A.map(e=>(0,i.jsxs)("div",{style:{marginBottom:8},children:[(0,i.jsxs)("strong",{children:[e.senderName,": "]}),e.text]},e.id))}),(0,i.jsxs)("form",{onSubmit:sendPrivateMessage,style:{display:"flex",gap:8,marginTop:10},children:[(0,i.jsx)("input",{value:K,onChange:e=>O(e.target.value),placeholder:"Type a message...",style:{flex:1,padding:8,borderRadius:8}}),(0,i.jsx)("button",{style:x,children:"Send"})]})]}):(0,i.jsx)("div",{style:h,children:"Tap “Message” on a user to start chatting."})]}),"community"===w&&(0,i.jsxs)("section",{children:[(0,i.jsx)("h2",{style:p,children:"Community Feed"}),(0,i.jsxs)("form",{onSubmit:postToCommunity,style:{display:"flex",gap:8,marginBottom:10},children:[(0,i.jsx)("input",{value:F,onChange:e=>P(e.target.value),placeholder:"Share something...",style:{flex:1,padding:8,borderRadius:8}}),(0,i.jsx)("button",{style:x,children:N?"Posting...":"Post"})]}),T.map(e=>(0,i.jsxs)("div",{style:{background:"#0e0e0e",padding:10,borderRadius:10,marginBottom:10},children:[(0,i.jsx)("strong",{children:e.username}),(0,i.jsx)("p",{children:e.text})]},e.id))]}),"profile"===w&&(0,i.jsxs)("section",{style:{textAlign:"center"},children:[(0,i.jsx)("h2",{style:p,children:"Edit Profile"}),(0,i.jsx)("img",{src:R.photoURL||avatarFor(R),style:{width:100,height:100,borderRadius:"50%",marginBottom:10}}),(0,i.jsxs)("form",{onSubmit:async e=>{e.preventDefault();let t=(0,o.JU)(a.db,"users",R.uid);await (0,o.pl)(t,R,{merge:!0}),alert("Profile updated!")},style:{maxWidth:400,margin:"0 auto",textAlign:"left"},children:[(0,i.jsx)("label",{style:v,children:"Username"}),(0,i.jsx)("input",{style:C,value:R.username||"",onChange:e=>S({...R,username:e.target.value})}),(0,i.jsx)("label",{style:v,children:"Gender"}),(0,i.jsxs)("select",{style:C,value:R.gender||"",onChange:e=>S({...R,gender:e.target.value}),children:[(0,i.jsx)("option",{value:"",children:"Select gender"}),(0,i.jsx)("option",{value:"male",children:"Male"}),(0,i.jsx)("option",{value:"female",children:"Female"})]}),(0,i.jsx)("label",{style:v,children:"Photo URL"}),(0,i.jsx)("input",{style:C,value:R.photoURL||"",onChange:e=>S({...R,photoURL:e.target.value})}),(0,i.jsx)("button",{type:"submit",style:{...x,marginTop:10,width:"100%"},children:"Save Changes"})]})]})]})]}):(0,i.jsx)("div",{style:l,children:"Loading profile…"})}let l={minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff"},u={display:"flex",justifyContent:"space-between",alignItems:"center",padding:"14px 18px",borderBottom:"1px solid rgba(255,255,255,0.03)"},c={background:"#b30000",border:"none",padding:"8px 12px",borderRadius:8,color:"#fff"},m={display:"flex",gap:12,justifyContent:"center",padding:10,background:"#0b0b0b",borderBottom:"1px solid rgba(255,255,255,0.02)"},tabButton=e=>({background:e?"#1a0b0b":"transparent",color:e?"#ff6b6b":"#bbb",padding:"8px 14px",borderRadius:8,border:"none",cursor:"pointer"}),p={fontSize:20,marginBottom:10},h={color:"#aaa",marginBottom:10},g={display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(180px, 1fr))",gap:12},f={background:"#0e0e0e",padding:12,borderRadius:12,textAlign:"center"},b={width:72,height:72,borderRadius:"50%",objectFit:"cover"},x={background:"#b30000",color:"#fff",border:"none",padding:"8px 12px",borderRadius:8,cursor:"pointer"},y={background:"#0e0e0e",padding:10,borderRadius:8,height:"50vh",overflowY:"auto"},j={color:"#777",textAlign:"center",marginTop:20},v={display:"block",marginBottom:5,marginTop:10,color:"#aaa"},C={width:"100%",padding:8,borderRadius:8,border:"none",background:"#1a1a1a",color:"#fff"}},1163:function(e,t,s){e.exports=s(8355)}},function(e){e.O(0,[703,281,876,998,774,888,179],function(){return e(e.s=1075)}),_N_E=e.O()}]);