"use strict";(()=>{var e={};e.id=26,e.ids=[26,660],e.modules={8417:(e,t,s)=>{s.a(e,async(e,r)=>{try{s.r(t),s.d(t,{config:()=>b,default:()=>m,getServerSideProps:()=>x,getStaticPaths:()=>h,getStaticProps:()=>g,reportWebVitals:()=>f,routeModule:()=>R,unstable_getServerProps:()=>S,unstable_getServerSideProps:()=>C,unstable_getStaticParams:()=>j,unstable_getStaticPaths:()=>v,unstable_getStaticProps:()=>y});var a=s(7093),i=s(5244),o=s(1323),n=s(7481),l=s.n(n),d=s(7648),u=s(7917),c=e([d,u]);[d,u]=c.then?(await c)():c;let p=a.PagesRouteModule,m=(0,o.l)(u,"default"),g=(0,o.l)(u,"getStaticProps"),h=(0,o.l)(u,"getStaticPaths"),x=(0,o.l)(u,"getServerSideProps"),b=(0,o.l)(u,"config"),f=(0,o.l)(u,"reportWebVitals"),y=(0,o.l)(u,"unstable_getStaticProps"),v=(0,o.l)(u,"unstable_getStaticPaths"),j=(0,o.l)(u,"unstable_getStaticParams"),S=(0,o.l)(u,"unstable_getServerProps"),C=(0,o.l)(u,"unstable_getServerSideProps"),R=new p({definition:{kind:i.x.PAGES,page:"/dashboard",pathname:"/dashboard",bundlePath:"",filename:""},components:{App:d.default,Document:l()},userland:u});r()}catch(e){r(e)}})},7917:(e,t,s)=>{s.a(e,async(e,r)=>{try{s.r(t),s.d(t,{default:()=>Dashboard});var a=s(997),i=s(6689),o=s(7315),n=s(401),l=s(1492),d=s(1163),u=e([o,n,l]);function Dashboard(){let e=(0,d.useRouter)(),[t,s]=(0,i.useState)(null),[r,u]=(0,i.useState)(null),[P,w]=(0,i.useState)("discover"),[U,_]=(0,i.useState)([]),[k,B]=(0,i.useState)(!0),[T,L]=(0,i.useState)([]),[D,F]=(0,i.useState)(""),[q,M]=(0,i.useState)(!1),[A,I]=(0,i.useState)(null),[N,E]=(0,i.useState)([]),[z,W]=(0,i.useState)(""),G=(0,i.useRef)(null),H=(0,i.useRef)(null),[K,V]=(0,i.useState)([]),[J,O]=(0,i.useState)(!0),avatarFor=e=>e?"female"===e.gender?"/avatars/female.png":e.photoURL||"/avatars/male.png":"/avatars/male.png";(0,i.useEffect)(()=>{let t=(0,n.onAuthStateChanged)(o.I8,async t=>{if(!t){e.push("/signin");return}s(t);let r=(0,l.doc)(o.db,"users",t.uid),a=await (0,l.getDoc)(r);if(a.exists())u(a.data());else{let e={uid:t.uid,username:t.displayName||(t.email?t.email.split("@")[0]:"User"),gender:null,photoURL:t.photoURL||null,email:t.email,createdAt:(0,l.serverTimestamp)()};await (0,l.setDoc)(r,e),u(e)}});return()=>t()},[]),(0,i.useEffect)(()=>{(0,o.ZK)(),(0,o.xi)();let e=(0,l.query)((0,l.collection)(o.db,"users"),(0,l.orderBy)("createdAt","desc")),t=!0,s=(0,l.onSnapshot)(e,e=>{if(t){t=!1;return}let s=e.docChanges().filter(e=>"added"===e.type)[0];if(s){let e=s.doc.data();"granted"===Notification.permission&&new Notification("\uD83C\uDF89 New User Joined!",{body:`${e.username} just joined CUK Gossip.`,icon:e.photoURL||"/avatars/male.png"})}});return()=>s()},[]),(0,i.useEffect)(()=>{if(!r)return;B(!0);let e=(0,l.query)((0,l.collection)(o.db,"users"),(0,l.orderBy)("createdAt","desc")),t=(0,l.onSnapshot)(e,e=>{let t=e.docs.map(e=>e.data()).filter(e=>e.uid!==r.uid);_(t),B(!1)});return()=>t()},[r]),(0,i.useEffect)(()=>{let e=(0,l.query)((0,l.collection)(o.db,"communityFeed"),(0,l.orderBy)("timestamp","desc")),t=(0,l.onSnapshot)(e,e=>{L(e.docs.map(e=>({id:e.id,...e.data()})))});return()=>t()},[]),(0,i.useEffect)(()=>{if(!r)return;O(!0);let e=(0,l.query)((0,l.collection)(o.db,"chats"),(0,l.where)("users","array-contains",r.uid),(0,l.orderBy)("lastUpdated","desc")),t=(0,l.onSnapshot)(e,e=>{let t=e.docs.map(e=>({id:e.id,...e.data()}));V(t),O(!1)});return()=>t()},[r]);let chatIdFor=(e,t)=>[e,t].sort().join("_"),openPrivateChat=async e=>{if(!r)return;let t=chatIdFor(r.uid,e.uid),s=(0,l.doc)(o.db,"chats",t),a=await (0,l.getDoc)(s);a.exists()||await (0,l.setDoc)(s,{users:[r.uid,e.uid],userMeta:{[r.uid]:{username:r.username,photoURL:r.photoURL||null},[e.uid]:{username:e.username,photoURL:e.photoURL||null}},createdAt:(0,l.serverTimestamp)(),lastUpdated:(0,l.serverTimestamp)()}),subscribeToChatMessages(t),I(e),w("messages")},subscribeToChatMessages=e=>{if(H.current&&(H.current(),H.current=null),!e)return;let t=(0,l.collection)(o.db,"chats",e,"messages"),s=(0,l.query)(t,(0,l.orderBy)("timestamp","asc")),r=(0,l.onSnapshot)(s,e=>{let t=e.docs.map(e=>({id:e.id,...e.data()}));E(t),setTimeout(()=>{G.current&&(G.current.scrollTop=G.current.scrollHeight)},80)});H.current=r},sendPrivateMessage=async e=>{if(e?.preventDefault(),!z.trim()||!r||!A)return;let t=chatIdFor(r.uid,A.uid);await (0,l.addDoc)((0,l.collection)(o.db,"chats",t,"messages"),{senderUid:r.uid,senderName:r.username,text:z.trim(),timestamp:(0,l.serverTimestamp)()}),await (0,l.setDoc)((0,l.doc)(o.db,"chats",t),{lastUpdated:(0,l.serverTimestamp)()},{merge:!0}),W("")},postToCommunity=async e=>{e?.preventDefault(),D.trim()&&r&&(M(!0),await (0,l.addDoc)((0,l.collection)(o.db,"communityFeed"),{uid:r.uid,username:r.username,text:D.trim(),timestamp:(0,l.serverTimestamp)()}),F(""),M(!1))},doLogout=async()=>{await (0,n.signOut)(o.I8),localStorage.removeItem("user"),e.push("/signin")};return r?(0,a.jsxs)("div",{style:{minHeight:"100vh",background:"#070708",color:"#fff",fontFamily:"Inter, sans-serif"},children:[(0,a.jsxs)("header",{style:p,children:[(0,a.jsxs)("div",{children:[a.jsx("strong",{style:{color:"#ff5252",fontSize:20},children:"CUK Gossip"}),a.jsx("div",{style:{fontSize:12,color:"#aaa"},children:"Meet • Chat • Connect"})]}),(0,a.jsxs)("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[(0,a.jsxs)("div",{style:{textAlign:"right"},children:[a.jsx("div",{style:{fontWeight:700},children:r.username}),a.jsx("div",{style:{fontSize:12,color:"#bbb"},children:r.gender||"Not specified"})]}),a.jsx("img",{src:r.photoURL||avatarFor(r),alt:"me",style:{width:44,height:44,borderRadius:999}}),a.jsx("button",{onClick:doLogout,style:m,children:"Logout"})]})]}),(0,a.jsxs)("nav",{style:g,children:[a.jsx("button",{onClick:()=>w("discover"),style:tabButton("discover"===P),children:"Discover"}),a.jsx("button",{onClick:()=>w("messages"),style:tabButton("messages"===P),children:"Messages"}),a.jsx("button",{onClick:()=>w("community"),style:tabButton("community"===P),children:"Community"}),a.jsx("button",{onClick:()=>w("profile"),style:tabButton("profile"===P),children:"Profile"})]}),(0,a.jsxs)("main",{style:{maxWidth:1e3,margin:"20px auto",padding:"0 14px"},children:["discover"===P&&(0,a.jsxs)("section",{children:[a.jsx("h2",{style:h,children:"Discover"}),k?a.jsx("div",{style:x,children:"Loading…"}):(0,a.jsxs)("div",{style:b,children:[0===U.length&&a.jsx("div",{style:S,children:"No users found."}),U.map(e=>(0,a.jsxs)("div",{style:f,children:[a.jsx("img",{src:e.photoURL||avatarFor(e),alt:e.username,style:y}),a.jsx("div",{style:{marginTop:6,fontWeight:700},children:e.username}),a.jsx("div",{style:{color:"#bbb",fontSize:13,marginBottom:8},children:e.gender||"-"}),a.jsx("button",{onClick:()=>openPrivateChat(e),style:v,children:"Message"})]},e.uid))]})]}),"messages"===P&&(0,a.jsxs)("section",{children:[a.jsx("h2",{style:h,children:"Messages"}),A?(0,a.jsxs)(a.Fragment,{children:[a.jsx("div",{style:j,ref:G,children:N.map(e=>(0,a.jsxs)("div",{style:{marginBottom:8},children:[(0,a.jsxs)("strong",{children:[e.senderName,": "]}),e.text]},e.id))}),(0,a.jsxs)("form",{onSubmit:sendPrivateMessage,style:{display:"flex",gap:8,marginTop:10},children:[a.jsx("input",{value:z,onChange:e=>W(e.target.value),placeholder:"Type a message...",style:{flex:1,padding:8,borderRadius:8}}),a.jsx("button",{style:v,children:"Send"})]})]}):a.jsx("div",{style:x,children:"Tap “Message” on a user to start chatting."})]}),"community"===P&&(0,a.jsxs)("section",{children:[a.jsx("h2",{style:h,children:"Community Feed"}),(0,a.jsxs)("form",{onSubmit:postToCommunity,style:{display:"flex",gap:8,marginBottom:10},children:[a.jsx("input",{value:D,onChange:e=>F(e.target.value),placeholder:"Share something...",style:{flex:1,padding:8,borderRadius:8}}),a.jsx("button",{style:v,children:q?"Posting...":"Post"})]}),T.map(e=>(0,a.jsxs)("div",{style:{background:"#0e0e0e",padding:10,borderRadius:10,marginBottom:10},children:[a.jsx("strong",{children:e.username}),a.jsx("p",{children:e.text})]},e.id))]}),"profile"===P&&(0,a.jsxs)("section",{style:{textAlign:"center"},children:[a.jsx("h2",{style:h,children:"Edit Profile"}),a.jsx("img",{src:r.photoURL||avatarFor(r),style:{width:100,height:100,borderRadius:"50%",marginBottom:10}}),(0,a.jsxs)("form",{onSubmit:async e=>{e.preventDefault();let t=(0,l.doc)(o.db,"users",r.uid);await (0,l.setDoc)(t,r,{merge:!0}),alert("Profile updated!")},style:{maxWidth:400,margin:"0 auto",textAlign:"left"},children:[a.jsx("label",{style:C,children:"Username"}),a.jsx("input",{style:R,value:r.username||"",onChange:e=>u({...r,username:e.target.value})}),a.jsx("label",{style:C,children:"Gender"}),(0,a.jsxs)("select",{style:R,value:r.gender||"",onChange:e=>u({...r,gender:e.target.value}),children:[a.jsx("option",{value:"",children:"Select gender"}),a.jsx("option",{value:"male",children:"Male"}),a.jsx("option",{value:"female",children:"Female"})]}),a.jsx("label",{style:C,children:"Photo URL"}),a.jsx("input",{style:R,value:r.photoURL||"",onChange:e=>u({...r,photoURL:e.target.value})}),a.jsx("button",{type:"submit",style:{...v,marginTop:10,width:"100%"},children:"Save Changes"})]})]})]})]}):a.jsx("div",{style:c,children:"Loading profile…"})}[o,n,l]=u.then?(await u)():u;let c={minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff"},p={display:"flex",justifyContent:"space-between",alignItems:"center",padding:"14px 18px",borderBottom:"1px solid rgba(255,255,255,0.03)"},m={background:"#b30000",border:"none",padding:"8px 12px",borderRadius:8,color:"#fff"},g={display:"flex",gap:12,justifyContent:"center",padding:10,background:"#0b0b0b",borderBottom:"1px solid rgba(255,255,255,0.02)"},tabButton=e=>({background:e?"#1a0b0b":"transparent",color:e?"#ff6b6b":"#bbb",padding:"8px 14px",borderRadius:8,border:"none",cursor:"pointer"}),h={fontSize:20,marginBottom:10},x={color:"#aaa",marginBottom:10},b={display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(180px, 1fr))",gap:12},f={background:"#0e0e0e",padding:12,borderRadius:12,textAlign:"center"},y={width:72,height:72,borderRadius:"50%",objectFit:"cover"},v={background:"#b30000",color:"#fff",border:"none",padding:"8px 12px",borderRadius:8,cursor:"pointer"},j={background:"#0e0e0e",padding:10,borderRadius:8,height:"50vh",overflowY:"auto"},S={color:"#777",textAlign:"center",marginTop:20},C={display:"block",marginBottom:5,marginTop:10,color:"#aaa"},R={width:"100%",padding:8,borderRadius:8,border:"none",background:"#1a1a1a",color:"#fff"};r()}catch(e){r(e)}})},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},997:e=>{e.exports=require("react/jsx-runtime")},9752:e=>{e.exports=import("@vercel/analytics/react")},3745:e=>{e.exports=import("firebase/app")},401:e=>{e.exports=import("firebase/auth")},1492:e=>{e.exports=import("firebase/firestore")},3512:e=>{e.exports=import("firebase/messaging")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},2781:e=>{e.exports=require("stream")},9796:e=>{e.exports=require("zlib")}};var t=require("../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),s=t.X(0,[481,450,792,362,163,370],()=>__webpack_exec__(8417));module.exports=s})();